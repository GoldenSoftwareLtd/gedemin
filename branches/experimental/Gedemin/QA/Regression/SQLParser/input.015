select
  DP.COD_EMPRESA,
  DP.COD_PESSOA,
  DP.DAT_EMISSAO_DUPPAG,
  DP.DAT_VENCTO_REAL_DUPPAG,
  DP.TIP_SITUACAO_DUPPAG,
  DP.VAL_DUPPAG,
  P.NOM_PESSOA,
  (SELECT NUM_NF FROM NFE WHERE NFE.COD_NFE = DP.COD_DUPPAG) NUM_NF,
  DP.NUM_DUPPAG,
  DP.OBS_DUPPAG,
  DP.TXT_HISTORICO_DUPPAG,
  DP.LOG_PREVISAO_DUPPAG,
  (EXTRACT (MONTH FROM DP.DAT_EMISSAO_DUPPAG)) NUM_MES_EMISSAO_DUPPAG,
  (EXTRACT (YEAR FROM DP.DAT_EMISSAO_DUPPAG)) NUM_ANO_EMISSAO_DUPPAG 
from 
  DUPLICATAS_PAGAR DP, PESSOAS P
where
  (DP.COD_PESSOA = P.COD_PESSOA)
  and (
    (((:LOG_TODAS_EMPRESAS_PRM = 0)
        and (DP.COD_EMPRESA in (:COD_EMPRESA_PRM)))
      or ((:LOG_TODAS_EMPRESAS_PRM = -1)
        and ((:LOG_USUARIO_JJW = -1)
          or (DP.COD_EMPRESA in (
              select
                E.COD_EMPRESA
              from
                EMPRESAS_USUARIOS E
              where
                (
                  (E.COD_USUARIO = :COD_USUARIO)
                )
            )
          ))))
    and (((:DAT_VENCTO_DUPPAG_INI_PRM is null)
        or (DP.DAT_VENCTO_REAL_DUPPAG >= :DAT_VENCTO_DUPPAG_INI_PRM))
      and ((:DAT_VENCTO_DUPPAG_FIN_PRM is null)
        or (DP.DAT_VENCTO_REAL_DUPPAG <= :DAT_VENCTO_DUPPAG_FIN_PRM)))
    and (((:DAT_EMISSAO_DUPPAG_INI_PRM is null)
        or (DP.DAT_EMISSAO_DUPPAG >= :DAT_EMISSAO_DUPPAG_INI_PRM))
      and ((:DAT_EMISSAO_DUPPAG_FIN_PRM is null)
        or (DP.DAT_EMISSAO_DUPPAG <= :DAT_EMISSAO_DUPPAG_FIN_PRM)))
    and (DP.LOG_PREVISAO_DUPPAG in (:LOG_PREVISAO_DUPPAG_PRM))
    and (upper(DP.TIP_SITUACAO_DUPPAG) in (:TIP_SITUACAO_DUPPAG_PRM))
    and ((:COD_PESSOA_PRM is null)
      or (DP.COD_PESSOA = :COD_PESSOA_PRM))'
  )